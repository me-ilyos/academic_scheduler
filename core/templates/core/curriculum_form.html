{% extends "dashboard_layout.html" %}

{% block title %}Create Curriculum{% endblock %}

{% block content %}
<div class="container-fluid p-4">
    <div class="card">
        <div class="card-body">
            <h2 class="mb-4">Create New Curriculum</h2>
            
            <form method="post">
                {% csrf_token %}
                
                <div class="row g-3 mb-4">
                    <div class="col-md-3">
                        <label class="form-label">Title</label>
                        <input type="text" class="form-control" name="title" required>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Code</label>
                        <input type="text" class="form-control" name="code" required>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Duration (years)</label>
                        <input type="number" class="form-control" name="duration" min="1" max="6" required>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Degree Type</label>
                        <select class="form-select" name="degree_type" required>
                            <option value="BS">Bachelor</option>
                            <option value="MS">Master of Science</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Total Credits</label>
                        <input type="number" class="form-control" name="total_credits" required>
                    </div>
                </div>

                <div class="table-responsive mt-4">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th rowspan="2" class="align-middle" style="width: 120px">Course Code</th>
                                <th rowspan="2" class="align-middle">Course Title</th>
                                <th colspan="6" class="text-center">Classroom hours</th>
                                <th rowspan="2" class="align-middle" style="width: 80px">Total Load</th>
                                <th colspan="8" class="text-center">Hours per week in semester</th>
                                <th colspan="8" class="text-center">Credits per semester</th>
                                <th rowspan="2" class="align-middle" style="width: 80px">Total Credits</th>
                            </tr>
                            <tr>
                                <th>Total</th>
                                <th>Lecture</th>
                                <th>Practice</th>
                                <th>Laboratory</th>
                                <th>Seminar</th>
                                <th>Self-study</th>
                                <th>1</th>
                                <th>2</th>
                                <th>3</th>
                                <th>4</th>
                                <th>5</th>
                                <th>6</th>
                                <th>7</th>
                                <th>8</th>
                                <th>1</th>
                                <th>2</th>
                                <th>3</th>
                                <th>4</th>
                                <th>5</th>
                                <th>6</th>
                                <th>7</th>
                                <th>8</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <input type="text" class="form-control form-control-sm" name="course_code[]" placeholder="Code">
                                </td>
                                <td>
                                    <input type="text" class="form-control form-control-sm" name="course_title[]" placeholder="Title">
                                </td>
                                <td>
                                    <input type="number" class="form-control form-control-sm" name="total_hours[]">
                                </td>
                                <td>
                                    <input type="number" class="form-control form-control-sm" name="lecture_hours[]">
                                </td>
                                <td>
                                    <input type="number" class="form-control form-control-sm" name="practice_hours[]">
                                </td>
                                <td>
                                    <input type="number" class="form-control form-control-sm" name="lab_hours[]">
                                </td>
                                <td>
                                    <input type="number" class="form-control form-control-sm" name="seminar_hours[]">
                                </td>
                                <td>
                                    <input type="number" class="form-control form-control-sm" name="self_study_hours[]">
                                </td>
                                <td>
                                    <input type="number" class="form-control form-control-sm" name="total_load[]" readonly>
                                </td>
                                <td>
                                    <input type="number" class="form-control form-control-sm" name="hours_sem1[]" min="0" max="30">
                                </td>
                                <td>
                                    <input type="number" class="form-control form-control-sm" name="hours_sem2[]" min="0" max="30">
                                </td>
                                <td>
                                    <input type="number" class="form-control form-control-sm" name="hours_sem3[]" min="0" max="30">
                                </td>
                                <td>
                                    <input type="number" class="form-control form-control-sm" name="hours_sem4[]" min="0" max="30">
                                </td>
                                <td>
                                    <input type="number" class="form-control form-control-sm" name="hours_sem5[]" min="0" max="30">
                                </td>
                                <td>
                                    <input type="number" class="form-control form-control-sm" name="hours_sem6[]" min="0" max="30">
                                </td>
                                <td>
                                    <input type="number" class="form-control form-control-sm" name="hours_sem7[]" min="0" max="30">
                                </td>
                                <td>
                                    <input type="number" class="form-control form-control-sm" name="hours_sem8[]" min="0" max="30">
                                </td>
                                <td>
                                    <input type="number" class="form-control form-control-sm" name="credits_sem1[]" min="0" max="8">
                                </td>
                                <td>
                                    <input type="number" class="form-control form-control-sm" name="credits_sem2[]" min="0" max="8">
                                </td>
                                <td>
                                    <input type="number" class="form-control form-control-sm" name="credits_sem3[]" min="0" max="8">
                                </td>
                                <td>
                                    <input type="number" class="form-control form-control-sm" name="credits_sem4[]" min="0" max="8">
                                </td>
                                <td>
                                    <input type="number" class="form-control form-control-sm" name="credits_sem5[]" min="0" max="8">
                                </td>
                                <td>
                                    <input type="number" class="form-control form-control-sm" name="credits_sem6[]" min="0" max="8">
                                </td>
                                <td>
                                    <input type="number" class="form-control form-control-sm" name="credits_sem7[]" min="0" max="8">
                                </td>
                                <td>
                                    <input type="number" class="form-control form-control-sm" name="credits_sem8[]" min="0" max="8">
                                </td>
                                <td>
                                    <input type="number" class="form-control form-control-sm" name="total_credits[]" readonly>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="mt-4 d-flex gap-2">
                    <button type="button" class="btn btn-secondary" id="addRow">Add Course</button>
                    <button type="submit" class="btn btn-primary">Save Curriculum</button>
                    <a href="{% url 'department_admin_dashboard' %}" class="btn btn-outline-secondary">Cancel</a>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
    .card {
        border: none;
        box-shadow: 0 1px 3px rgba(0,0,0,0.12);
    }
    .form-control, .form-select {
        border-radius: 0.375rem;
    }
    .table th {
        background-color: #f8f9fa;
        vertical-align: middle;
        text-align: center;
    }
    .form-control-sm {
        padding: 0.25rem 0.5rem;
        font-size: 0.875rem;
    }
    .table td {
        padding: 0.5rem;
    }
    input[type="number"] {
        width: 60px;
    }
    .table {
        font-size: 0.85rem;
    }
    .form-control-sm {
        height: 28px;
        min-height: 28px;
    }
</style>

<script>
document.getElementById('addRow').addEventListener('click', function() {
    const tbody = document.querySelector('tbody');
    const newRow = tbody.firstElementChild.cloneNode(true);
    
    newRow.querySelectorAll('input').forEach(input => {
        input.value = '';
    });
    
    tbody.appendChild(newRow);
});

document.addEventListener('input', function(e) {
    if (e.target.matches('input[type="number"]')) {
        const row = e.target.closest('tr');
        
        // Calculate total hours
        const total = row.querySelector('input[name="total_load[]"]');
        const hours = [
            row.querySelector('input[name="total_hours[]"]'),
            row.querySelector('input[name="lecture_hours[]"]'),
            row.querySelector('input[name="practice_hours[]"]'),
            row.querySelector('input[name="lab_hours[]"]'),
            row.querySelector('input[name="seminar_hours[]"]'),
            row.querySelector('input[name="self_study_hours[]"]')
        ];
        
        const hoursSum = hours.reduce((acc, input) => acc + (Number(input.value) || 0), 0);
        total.value = hoursSum;

        // Calculate total credits
        const totalCredits = row.querySelector('input[name="total_credits[]"]');
        const credits = [
            row.querySelector('input[name="credits_sem1[]"]'),
            row.querySelector('input[name="credits_sem2[]"]'),
            row.querySelector('input[name="credits_sem3[]"]'),
            row.querySelector('input[name="credits_sem4[]"]'),
            row.querySelector('input[name="credits_sem5[]"]'),
            row.querySelector('input[name="credits_sem6[]"]'),
            row.querySelector('input[name="credits_sem7[]"]'),
            row.querySelector('input[name="credits_sem8[]"]')
        ];
        
        const creditsSum = credits.reduce((acc, input) => acc + (Number(input.value) || 0), 0);
        totalCredits.value = creditsSum;
    }
});
</script>
{% endblock %}